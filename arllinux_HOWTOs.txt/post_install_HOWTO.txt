# ==================================
Premiers réglages post installation
# ==================================

# arllinux - jpantinoux - 3 mars 2014

Franciser le système
# vim /etc/locale.d/lang.sh

# en_US is the Slackware default locale:
#export LANG=en_US
export LANG=fr_FR.utf8

---/---

#export LC_COLLATE=C
export LC_COLLATE=fr_FR.utf8

==================================================
Récupérer la liste des modules à intéger au noyau
==================================================

# cd /usr/share/mkinird/
# ./mkinitrd_command_generator.sh

# mkinitrd_command_generator.sh revision 1.45
#
# This script will now make a recommendation about the command to use
# in case you require an initrd image to boot a kernel that does not
# have support for your storage or root filesystem built in
# (such as the Slackware 'generic' kernels').
# A suitable 'mkinitrd' command will be:

mkinitrd -c -k 3.10.17-smp -f ext4 -r /dev/sda3 -m usb-storage:ums-realtek:ehci-hcd:ehci-pci:usbhid:hid_generic:ohci-hcd:mbcache:jbd2:ext4 -u -o /boot/initrd.gz

Il faudra récupérer toutes les informations entre les paramètres -m et -u pour les reporter dans une des lignes du fichier mkinitrd.conf

Inutile de les noter sur un morceau de papier, nous verrons comment les
intégrer au bon endroit dans le fichier "mkinitrd.conf"

==================================
Modifier le fichier mkinitrd.conf
==================================

Contenu du fichier mkinitrd.conf.sample

# mkinitrd.conf.sample
# See "man mkinitrd.conf" for details on the syntax of this file
#
#SOURCE_TREE="/boot/initrd-tree"
#CLEAR_TREE="0"
#OUTPUT_IMAGE="/boot/initrd.gz"
#KERNEL_VERSION="$(uname -r)"
#KEYMAP="us"
#MODULE_LIST="ext4"
#LUKSDEV="/dev/sda2"
#LUKSKEY="LABEL=TRAVELSTICK:/keys/alienbob.luks"
#ROOTDEV="/dev/sda1"
#ROOTFS="ext3"
#RESUMEDEV="/dev/sda2"
#RAID="0"
#LVM="0"
#UDEV="1"
#MODCONF="0"
#WAIT="1"

# cd /etc
# cp mkinird.conf.sample mkinird.conf
# vim mkinird.conf

# mkinitrd.conf
# See "man mkinitrd.conf" for details on the syntax of this file
#
SOURCE_TREE="/boot/initrd-tree"
CLEAR_TREE="1"
OUTPUT_IMAGE="/boot/initrd.gz"
KERNEL_VERSION="$(uname -r)"
KEYMAP="fr-latin1"
MODULE_LIST="usb-storage:ums-realtek:ehci-hcd:ehci-pci:usbhid:hid_generic:ohci-hcd:mbcache:jbd2:ext4"
ROOTDEV="/dev/sda3"
ROOTFS="ext4"
RAID="0"
LVM="0"
UDEV="1"
MODCONF="0"
WAIT="1"

Pour enlever tous les signes # au début de chaque lignes, il faut se placer sur le premier #, puis Ctrl + v
Etendre la sélection vers le bas en appuyant sur la touche j
Pour supprimer la sélection pressez la touche d

Pour intégrer la liste des modules dans la ligne "MODULE_LIST"
Supprimer tout d'abord le module ext4 et ne laisser que les deux guillements
MODULE_LIST=""

Ensuite faire apparaitre le résultat de la commande
"mkinitrd_command_generator.sh" en invoquant :r ! suivi du chemin du script :
:r ! /usr/share/mkinird/mkinitrd_command_generator.sh

Il faut récupérer la liste des modules en utilisant les touches Ctrl +v sur le
premier caractère de la liste, puis étendre la sélection aves la touche "l"
jusqu'à l'avant dernier caractère. En réalisté le curseur clignote sur la
dernière lettre mais la sélection semble s'arrêter au caractère précédant.
Puis après avoir appuyer sur la touche "x" pour couper, coller le texte en
vous plaçant sur la première parenthèse de la ligne MODULE_LIST.
Coller en appuyant sur "p"
Supprimer les lignes résiduèles.

==============================
Modifier le fichier lilo.conf
==============================
Avant :
# LILO configuration file
# generated by 'liloconfig'
#
# Start LILO global section
# Append any additional kernel parameters:
append=" vt.default_utf8=1 " 
boot = /dev/sda
#compact        # faster, but won't work on all systems.
---/---
# Linux bootable partition config begins
image = /boot/vmlinuz
  root = /dev/sda3
  label = Linux
  read-only
# Linux bootable partition config ends

Après
# LILO configuration file
# generated by 'liloconfig'
#
# Start LILO global section
# Append any additional kernel parameters:
append="quiet vt.default_utf8=1 video=1920x1080"
boot = /dev/sda
compact        # faster, but won't work on all systems.
lba32
---/---
# Linux bootable partition config begins
image = /boot/vmlinuz-generic-smp-3.10.17-smp
  initrd = /boot/initrd.gz
  root = /dev/sda3
  label = LinuxGeneric
  read-only
# Linux bootable partition config ends

================================
Construire l'initrd
================================

# mkinitrd -F

Puis ne pas oublier de rafraichir lilo

# lilo


